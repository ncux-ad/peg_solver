# Peg Solver

Высокопроизводительный решатель головоломки Peg Solitaire с использованием современных алгоритмов поиска.

## Описание

Проект решает классическую головоломку "Колышки" (Peg Solitaire) с помощью комбинации алгоритмов:
- **A\*** с продвинутыми эвристиками
- **IDA\*** (Iterative Deepening A*) для экономии памяти
- **Bidirectional Search** — двунаправленный поиск
- **Pattern-based Solver** — быстрое решение типовых позиций
- **Pagoda Function Pruning** — отсечение недостижимых состояний

## Ключевые оптимизации

### Представление данных
- `frozenset` вместо `list[list]` — O(1) операции с состояниями
- Иммутабельный `Board` класс с предвычисленным хешем
- Parent pointers вместо копирования путей

### Алгоритмы
- **Pagoda function** для раннего отсечения невозможных позиций
- **Symmetry reduction** — учёт симметрий доски (8x сокращение пространства)
- **Dead-end detection** — обнаружение тупиковых позиций
- **Mobility heuristic** — оценка гибкости позиции

### Эвристики
- Расстояние до центра
- Штраф за изолированные колышки
- Штраф за колышки на краях
- Бонус за кластеризацию
- Бонус за мобильность

## Быстрый старт

```bash
# Демо с английской доской
python main.py

# С указанием позиции
python main.py "size=7x7 pegs=A2,A6,B2,B4,B6 empty=D4"
```

### Программное использование

```python
from board import Board
from solver import hybrid_solver, a_star_solver
from main import create_english_board

# Стандартная английская доска
board = create_english_board()
solution = hybrid_solver(board)

# Или напрямую с Board классом
board_obj = Board.from_matrix(board)
solution = a_star_solver(board_obj, center=(3, 3))
```

## Структура проекта

```
peg_solver/
├── main.py            # Точка входа CLI
├── board.py           # Оптимизированное представление доски
├── solver.py          # A*, IDA*, Bidirectional, Hybrid
├── reverse_solver.py  # Обратный поиск
├── heuristics.py      # Эвристические функции
├── invariants.py      # Pagoda function и инварианты
├── patterns.py        # Паттерны для жадного решения
├── solutions_db.py    # Кэш решений
├── visualizer.py      # Визуализация
└── utils.py           # Общие утилиты
```

## Формат ввода

```
size=7x7 pegs=A2,A6,B2,B4,B6,... empty=D4
```

- `size` — размер доски (rows x cols)
- `pegs` — позиции колышков (буква = столбец, цифра = строка)
- `empty` — позиции пустых мест

## Алгоритмы

### A* Search
Информированный поиск с эвристикой. Гарантирует оптимальное решение при допустимой эвристике.

### IDA* (Iterative Deepening A*)
Вариант A* с ограничением по глубине. Экономит память за счёт повторных обходов.

### Bidirectional Search
Поиск одновременно от начала и от цели. Встречаются посередине — экспоненциальное ускорение.

### Pagoda Function
Математический инвариант для доказательства невозможности решения. Позволяет отсечь целые ветви поиска.

## Требования

- Python 3.8+
- Стандартная библиотека (без внешних зависимостей)

## Производительность

| Метрика | До оптимизации | После |
|---------|---------------|-------|
| Представление доски | O(n²) deepcopy | O(1) frozenset ops |
| Хеширование | O(n²) | O(1) cached |
| Подсчёт колышков | O(n²) каждый раз | O(1) len() |
| Symmetry | Не использовалось | 8x reduction |
| Pruning | Нет | Pagoda + Dead-end |

## Лицензия

MIT

## Статус проекта

**Активный** — проект развивается и оптимизируется
